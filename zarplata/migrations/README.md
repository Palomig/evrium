# Инструкция по применению миграции

## Миграция: Привязка формулы оплаты к преподавателю

**Дата**: 2025-11-16

### Что делает эта миграция?

Добавляет поле `formula_id` в таблицу `teachers`, чтобы формула оплаты была привязана к преподавателю, а не к каждому уроку отдельно. При выборе преподавателя формула будет подставляться автоматически.

### Как применить миграцию?

#### Вариант 1: Через phpMyAdmin на хостинге

1. Зайдите в phpMyAdmin на хостинге Timeweb
2. Выберите базу данных `cw95865_admin`
3. Перейдите на вкладку "SQL"
4. Скопируйте и выполните содержимое файла `add_formula_to_teachers.sql`
5. Проверьте результат: откройте структуру таблицы `teachers` - должно появиться поле `formula_id`

#### Вариант 2: Через SSH (если доступен)

```bash
cd /path/to/zarplata/migrations
mysql -u cw95865_admin -p cw95865_admin < add_formula_to_teachers.sql
```

### Что изменится после миграции?

1. ✅ У каждого преподавателя будет своя формула оплаты
2. ✅ При создании урока формула будет подставляться автоматически из данных преподавателя
3. ✅ Существующие формулы из уроков будут автоматически присвоены преподавателям
4. ✅ Можно будет настраивать формулу для преподавателя на странице "Преподаватели"

### Проверка успешности миграции

После выполнения миграции выполните запрос:

```sql
SELECT t.name, pf.name as formula_name
FROM teachers t
LEFT JOIN payment_formulas pf ON t.formula_id = pf.id
WHERE t.active = 1;
```

Вы должны увидеть список преподавателей с их формулами оплаты.
