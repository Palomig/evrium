<?php
/**
 * –ö–æ–º–∞–Ω–¥–∞ /start - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
 */

function handleStartCommand($chatId, $telegramId, $username) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–≤—è–∑–∞–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç Telegram ID
    $teacher = getTeacherByTelegramId($telegramId);

    if ($teacher) {
        sendTelegramMessage($chatId,
            "‚úÖ –í–∞—à –∞–∫–∫–∞—É–Ω—Ç —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω!\n\n" .
            "üë§ <b>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:</b> {$teacher['name']}\n" .
            "üì± <b>Telegram:</b> @{$username}\n\n" .
            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –Ω–∏–∂–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.",
            getMainMenuKeyboard()
        );
        return;
    }

    // –ï—Å–ª–∏ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    sendTelegramMessage($chatId,
        "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Zarplata Bot!</b>\n\n" .
        "–î–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.\n\n" .
        "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω:\n" .
        "1. –ó–∞–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –Ω–∞ —ç–≤—Ä–∏—É–º.—Ä—Ñ/zarplata\n" .
        "2. –û—Ç–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª \"–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏\"\n" .
        "3. –ù–∞–π—Ç–∏ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å –∏ —É–∫–∞–∑–∞—Ç—å Telegram ID: <code>{$telegramId}</code>\n\n" .
        "–ü–æ—Å–ª–µ –ø—Ä–∏–≤—è–∑–∫–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Ä–æ–∫–∞—Ö –∏ –≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞—Ä–∞–±–æ—Ç–∫–∞.",
        getMainMenuKeyboard()
    );

    // –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ø—ã—Ç–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    try {
        logAudit(
            'bot_registration_attempt',
            'teacher',
            null,
            null,
            ['telegram_id' => $telegramId, 'username' => $username],
            "–ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ"
        );
    } catch (Exception $e) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        error_log("Failed to log audit: " . $e->getMessage());
    }
}
