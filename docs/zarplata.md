# Техническое задание (ТЗ) для системы учёта зарплат преподавателей

## 1. Общая информация

Проект: **Система учёта зарплаты преподавателей + Telegram‑бот**\
Стек: **HTML/CSS/JS (фронт), PHP (backend), MySQL (БД)**\
Развёртывание: **Shared hosting (Apache + PHP + MySQL)**\
Интерфейсы:\
- Админ‑панель (только для владельца)\
- Telegram‑бот (для преподавателей)\
Язык интерфейса: **русский**

------------------------------------------------------------------------

## 2. Цели системы

1.  Автоматизировать учёт посещаемости учеников и начисление зарплаты
    преподавателям.\
2.  Обеспечить удобное расписание и управление временными переносами
    уроков.\
3.  Предоставлять отчёты преподавателям и владельцу (в Telegram и в
    админ‑панели).\
4.  Учитывать разный формат уроков и кастомизируемые формулы оплаты.

------------------------------------------------------------------------

## 3. Бизнес-логика и особенности, уточнённые пользователем

### 3.1 Валюта

-   Все суммы в **рублях**, **без копеек**.

### 3.2 Переносы уроков

-   Перенос временный и относится только к текущей неделе.\
-   Постоянное расписание (шаблон) не меняется.\
-   При переносе:
    -   В исходном дне урок временно отменяется.\
    -   На новом дне создаётся «инстанс» разового урока.\
    -   На следующей неделе всё возвращается к шаблону.

### 3.3 Частичная явка

-   Частичной оплаты **нет**.\
-   Учитель выбирает: **«Все пришли» / «Нет»**.\
-   Если «Нет» --- выбирает отсутствующих.

### 3.4 Замены преподавателей

-   Система должна поддерживать назначение **замещающего
    преподавателя**.\
-   ЗП начисляется тому, кому назначено занятие в конкретный день.

### 3.5 Зарплатные циклы

-   Возможность рассчитать выплаты:
    -   **раз в месяц**,\
    -   **два раза в месяц**,\
    -   **разовая выплата** (произвольная сумма преподавателю).\
-   Интеграции с банками **не требуются**.\
-   Нужна статистика по выплатам и вашей доле.

### 3.6 Доступы

-   Админка: только владелец (логин/пароль).\
-   Преподаватели авторизуются **только через Telegram**.\
-   Бот реагирует **только на преподавателей**, добавленных в БД.

### 3.7 Расписание (импорт и ручное управление)

-   Основной файл расписания --- предоставленный Google Sheets.\
-   Реализовать **ручное добавление и редактирование уроков**.\
-   Полноценное управление расписанием в админке:
    -   Табличный интерфейс\
    -   Переносы уроков\
    -   Управление количеством учеников\
    -   Работа с шаблоном + инстансами

### 3.8 Время опроса бота

-   Бот должен спрашивать:\
    **через 15 минут после начала урока:**\
    → «Все ли пришли?»

### 3.9 Отчёты владельцу

-   2 вида отчётов:
    1)  **В Telegram текстовым сообщением**\
    2)  **В виде дашборда в админ‑панели**

### 3.10 История и возвраты

-   Вся история должна сохраняться.\
-   Возможность отменить начисление, изменить статус, пересчитать
    оплату.\
-   Учёт всех правок (audit log).

------------------------------------------------------------------------

## 4. Основной функционал

### 4.1 Пользователи и роли

-   **Админ** (вы): полный доступ.\
-   **Преподаватель**: доступ только через Telegram bot.

### 4.2 Telegram‑бот

-   Webhook на стороне PHP.\
-   Cron каждые 5--10 минут проверяет, какие уроки начались 15 минут
    назад.\
-   Диалог:
    1.  Вопрос: «Все ли пришли?»\
    2.  Если «Да» --- сохранить посещаемость.\
    3.  Если «Нет» --- показать список учеников.\
    4.  Учитель отмечает отсутствующих.\
    5.  Система фиксирует оплату.

### 4.3 Формулы расчёта

Поддерживаются три режима:

1.  **min_plus_per**
    -   min_payment\
    -   per_student начиная со второго или с настраиваемого порога
2.  **fixed**
    -   фиксированная сумма
3.  **expression**
    -   Пользовательская формула\
    -   Переменные: N (число учеников), min, base\
    -   Функции: max(), min(), +, -, \*, /

Интерфейс:\
✔ визуальное редактирование\
✔ возможность переключения формул\
✔ сохранение версий формул

### 4.4 Уроки и расписание

Структура: - Шаблон (еженедельно повторяется)\
- Инстансы (разовые изменения, переносы, отмены)

Возможности: - Добавить урок\
- Удалить урок\
- Перенести урок (только в пределах текущей недели)\
- Указать количество учеников\
- Привязать преподавателя\
- Указать тип: групповое или индивидуальное

### 4.5 Отчёты

#### Для преподавателя (Telegram)

-   Сколько заработал сегодня\
-   Сколько заработал за неделю\
-   Детализация: каждый урок, оплата, количество учеников

#### Для владельца

**В Telegram (текст):** - Что заработал преподаватель\
- Ваша доля\
- Итог по дням / неделям

**В админ‑панели (дашборд):** - Заработок преподавателей\
- Динамика по дням\
- Ваша прибыль\
- Фильтры: по преподавателю, по периоду

### 4.6 Журнал (Audit log)

Записывать: - Ответы преподавателей\
- Исправления (кто сделал, когда, почему)\
- Переносы и отмены\
- Пересчёты выплат

------------------------------------------------------------------------

## 5. Структура базы данных (обновлённая)

### Таблицы

-   users\
-   teachers\
-   students\
-   lessons_template (шаблон)\
-   lessons_instance (конкретные разовые занятия)\
-   lesson_students\
-   attendance_log\
-   payments\
-   group_formulas\
-   settings

------------------------------------------------------------------------

## 6. Админ‑панель --- UX

✔ Дашборд с графиками и суммами\
✔ Управление преподавателями\
✔ Управление расписанием в виде таблицы\
✔ Drag‑and‑drop для переноса уроков\
✔ Управление формулами оплаты\
✔ История и возвраты\
✔ Отчёты и выгрузки Excel\
✔ Просмотр логов

------------------------------------------------------------------------

## 7. Критерии приёмки

1.  Учитель получает сообщение через 15 минут после начала урока.\
2.  Отмечает присутствующих --- система корректно считает оплату.\
3.  Работают переносы: недельное расписание не ломается.\
4.  Формулы редактируются и применяются.\
5.  Отчёты правильно формируются (Telegram + панель).\
6.  Все изменения фиксируются в audit log.\
7.  Импорт расписания работает.\
8.  Админ‑панель позволяет вручную управлять всеми уроками.

------------------------------------------------------------------------

## 8. Дополнительные пожелания

-   Возможность фильтровать отчёты по преподавателям и дням\
-   Возможность вручную начислить сумму преподавателю\
-   Возможность отменить начисление

------------------------------------------------------------------------

ТЗ подготовлено с учётом всех внесённых корректировок и расширений.
